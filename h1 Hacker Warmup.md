### Johdanto
Ensimmäisen viikon tehtävä koostuu useasta osast. Viikon tehtävässä tutustutaan cyber kill chainiin, tutustutaan porttiskannaukseen ja moneen muuhun tunkeutumistestaus työkaluun.

Suoritan tehtävät Virtuaalikoneella.
Isäntä käyttöjärjestelmänä toimii Windows 10.

Minulla on käytössäni Lenovo IdeaPad Pro 5 jossa on AMD Ryzen 7 5800U CPU ja 16Gb RAM muistia.
Virtuaalikoneena minulla on Linux Kali jonka latasin osoitteesta: https://www.kali.org/get-kali/#kali-installer-images.

Virtuaalikone on asennettu VirtualBox ohjelmistolla.

## Sisällysluettelo
x. Lue/katso ja tiivistä

a. [Over the wire: Bandit level 0-2](#over-the-wire)

b. [WebGoat asennus](#webgoat-asennus)

c. [WebGoat HTTP basics and developer tools](#webgoat-http-basics-and-developer-tools)

d. [Portswigger "SQL injection vulnerability in WHERE clause allowing retrieval of hidden data"](#portswigger-sql-injection-vulnerability-in-where-clause)

e. [Asenna Linux virtuaalikone (Kali)](#asenna-linux-virtuaalikone-kali)

f. [Porttiskannaa omalta koneelta (localhost) 1000 tavallisinta TCP porttia](#porttiskannaa-omalta-koneelta-localhost-1000-tavallisinta-tcp-porttia)

g. Porttiskannaa kaikki TCP portit

h. [nmap -A](#nmap-a)

i. [Demonien asennus ja skannaus](#demonien-asennus-ja-skannaus)

j. [OSINT työkalu "Builtwith.com"](#osint-tyokalu-builtwithcom)

## X) Lue, katso ja tiivistä 2 julkaisua

€ Santos et al: The Art of Hacking (Video Collection): [..] 4.3 Surveying Essential Tools for Active Reconnaissance

Hutchins et al 2011: Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains

## A) Over the wire: Bandit level 0-2
Tehtävä on suorittaa tasot 0-2 OverTheWire harjoitteista.

Harjoitteet löytyvät https://overthewire.org/wargames/bandit/ osoitteesta.

Level 0 

    The goal of this level is for you to log into the game using SSH. 
    The host to which you need to connect is bandit.labs.overthewire.org, on port 2220.
    The username is bandit0 and the password is bandit0. 
    Once logged in, go to the Level 1 page to find out how to beat Level 1.
Ensimmäinen tehtävä on hyvin yksinkertainen. Annan seuraavat komennot saadakseni SSH pääsyn palvelimelle:

    ssh bandit0@bandit.labs.overthewire.org -p 2220
Jonka jälkeen terminaali pyytää minulta salasanaa joka on "bandit0". Level 0 on selätetty.

Level 0-1

    The password for the next level is stored in a file called readme located in the home directory.
    Use this password to log into bandit1 using SSH. 
    Whenever you find a password for a level, use SSH (on port 2220) to log into that level and continue the game.

Jälleen kerran hyvin yksinkertainen tehtävä.

<img width="282" alt="image" src="https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/41c97bfb-31a2-466e-aaf4-c266a4104102">

Käytin komentoa "cat" avatakseni tiedoston jossa seuraava salasana löytyi. TÄmän salasana avulla kirjaudun tunnuksella bandit1 samalle palvelimelle.

Level 1-2 

    The password for the next level is stored in a file called - located in the home directory

Tässä joudun hieman käyttämään avoimia lähteitä. En tiedä miten saan tiedoston nimeltä "-" auki.
https://stackoverflow.com/questions/42187323/how-to-open-a-dashed-filename-using-terminal

Blogin perusteella "-" nimisä tiedostoja pitää käyttää koko kansiorakenteen nimeä kun käyttää "cat" komentoa.

<img width="147" alt="image" src="https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/354ce23f-a063-4569-bed3-380fa0dc76c0">

Ja sieltä sain salasanan jolla voin kirjautua bandit2 tunnuksella palvelimelle.

level 2-3

    The password for the next level is stored in a file called spaces in this filename located in the home directory

Seuraava salasana löytyy tiedostosta joka on nimetty "spaces in this filename".
Pääsen käsiksi salasanaan niinkin yksinkertaisesti kuin "cat" ja tabulaattoria jolloin terminaali täyttää lopun automaattisesti.

<img width="197" alt="image" src="https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/3a63329f-067a-4b5c-ad87-d68cf3f5ff45">

level 3-4

    The password for the next level is stored in a hidden file in the inhere directory.

Kirjaudun bandit3 tunnuksella juuri saamani salasanan kanssa ja alan etsimään piiletettua tiedosta. Sen saan näkyviin "ls -a" komennolla tai käyttämällä tabulaattoria taas.

<img width="151" alt="image" src="https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/a0448d45-f58e-4920-b80d-3f382d4b387e">

Ja sieltä löytyi salasana. Helppoa kuin heinänteko

### B) WebGoat asennus
Tehtävänä on asentaa WebGoat palvelin omalle virtuaalikoneelle. Asennusta varten käytän Tero Karvisen laatimia ohjeita ( https://terokarvinen.com/2020/install-webgoat-web-pentest-practice-target/)

Asennusta varten tarvitsen seuraavat ohjelmistot:

  - OpenJDK
  - UFW
  - WGET
  - Bash-Completion

Olen juuri asentanut kalin uusimman distron ja kaikki nämä ovat valmiiksi asennettu. UFW demoni on myös käytössä.

Seuraavaksi lataan WebGoat.jar tiedoston jonka saan ladattua WGET avulla Tero Karvisen sivuilta (https://terokarvinen.com/2020/install-webgoat-web-pentest-practice-target/webgoat-server-8.0.0.M26.jar)

Tiedosto on noin 82mb kokoinen ja lataukseen meni noin 15 sekunttia.

Sitten olen valmis käynnistämään palvelimen omalle koneelleni. 

Palvelin asentuu komenolla:

    java -jar webgoat-server-8.0.0.M26.jar

Komento ajaa .jar tiedoston Javalla ja käynnistää ohjelman. Ohjelma jää pyörimään terminaaliin.

Tero Karvisen ohjeessa näyttää siltä että palvelin toimii portissa 8080. Kokeilen pääsenkö kiinni ohjelmaan selaimella.

<img width="341" alt="image" src="https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d481f870-db36-4b45-bc60-fb5c64d61974">

Näyttäähän tämä toimivan. Tähän mennessä ei ole tullut ongelmia vastaan.
Kirjautuakseni sisään minun pitää luoda uusi käyttäjä ohjelmalle. Webgoat antaa varoituksen minulle että kun käytän palvelinta tietokoneeni on hyvin altistunut hyökkäyksille.


### C) WebGoat HTTP basics and developer tools

Ennen kuin aloitan suorittamaan Webgoat tehtäviä kytken virtuaalikoneen irti natiivikoneen virtuaalikytkimestä. Tämä tapahtuu kali yläkulmassa olevasta "disconnect" painikkeesta.

Kirjautuakseni Webgoat palvelimeen luon uuden käyttäjän. 

Ensimmäisenä tehtävänä on antaa POST komento Webgoat palvelimelle. Annan inputiksi "putte" jonka jälkeen palvelin palauttaa tekstin käännettynä "ettup". 

HTTP basics viimeisenä tehtävänä on selvittää oliko edellisessä tehtävässä annettu komento POST tai GET. Sen saan selville tarkastamalla selaimen kehittäjätyökalun ja valitsemalla networks. Listasta näen yhden POST komennon tiedostolle Attack1.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/3f962c94-1715-4ca4-902a-7371a56be64e)

Tehtävän toisena osana on selvittää mikä on "magic number". Tässä jouduin hieman raapimaan päätäni ja selvittämään mikä se oli. Tarkastin networks osion ja POST komennon kaikki lisätiedot tuloksetta.

Inspector valikosta pystyn selaamaan sivun HTML koodia. Hakemalla "magic" hakusanaa löydän yhden arvon joka on magic number.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/8e63c43c-1339-42ea-a8db-b71e1684da50)

Tehtävän ratkaisuun käytin https://docs.cycubix.com/application-security-series/web-application-security-essentials/solutions/general/http-basics/http-basics-3 sivustoa avukseni.

Developer tools tehtävä:
Tehtävän osioiss 1-3 tutustutaan selaineb kehittäjätyökaluun ja miten eri asioiden kanssa voi toimia. 
Työkalussa voi tarkastella HTML koodia ja muokata sitä niin että sivu näyttää muokkaukset.
Console valikossa voi ajaa javascript komentoja selaimen omassa terminaalissa.

Osiossa 4 on tarkoitus ajaa javascript komento ja saada vastaus selaimelta:

        webgoat.customjs.phoneHome()
        
![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/da90b957-b01c-47c4-9271-17209998b51d)

Osiossa 6 tehtävänä on tarkastella POST pyynnön sisältö. Network valikosta näen kaikki POST ja GET pyynnöt. Tehtävässä on tarkoitus painaa "GO!" painiketta ja tarkastella mitä liikenettä syntyy. Valitsemalla network niminen POST pyyntö voidaan tarkastella pyynnön sisältöä.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/cd7c15c7-9808-4849-8024-1a806179dde9)

Lisään tämän numerosarjan vastauskenttään ja tämä on oikea vastaus.

### D) Portswigger "SQL injection vulnerability in WHERE clause allowing retrieval of hidden data"

Portswigger Labin suorittaminen vaati ilmaisen kirjautumisen portswigger.net sivustolle.
Tehtävänä on ratkaista SQL injection lab (https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data)

Tehtävää aloittaessa olin täysin hukassa. Tiedän mikä on SQL injektio mutta hyökkäyksen käyttäminen on minulle täysin tuntematon. Aloitan tehtävän tutustumalla yhteistön ratkaisuihin. Aloitan katsomalla Intigriti kanavat selostuksen ongelmanratkaisusta (https://www.youtube.com/watch?v=alTceRdSxS0).

Saadakseni hieman laajemman ymmäryksen hyökkäyksen luonteesta katson myös Rana Khalil tekemän videon hyökkäyksestä.
(https://www.youtube.com/watch?v=X1X1UdaC_90&t=51s).

Aloitan ongelman ratkaisemisen tarkastamalla harjoitteen ohjeistuksessa annetun SQL kyselyn.

      SELECT * FROM products WHERE category = 'Gifts' AND released = 1

Lausekkeesta näemme että SQL kysely hakee taulusta "products" kategorian jonka käyttäjä valitsee webbiliittymästä.
Esimerkkilausekkeesta näkyy myös että webbisovellus käyttää lauseketta missä käyttäjä antaa halutun kategorian jonka jälkeen sovellus tekee lausekkeen jossa se näyttää käyttäjälle kaikki julkaistut tuotteet " AND released =1".

Tarkastakseni validoiko webbisovellus käyttäjän syöttämät SQL inputit voin syöttää väärän SQL syntaksin suoraan URL:

        https://0abf00f903691bce80a7b2f000c8003f.web-security-academy.net/filter?category=Accessories
        
Kun käyttäjä valitsee kategorian Accessories niin ULR loppu näyttää =Accessories. TÄmä antaa indikaation
että SQL lauseke näyttäisi seuraavalta:

        SELECT * FROM products WHERE category='Accessories' AND released=1

Kokeilen lisäämällä URL merkin ' joka rikkoo syntaksin.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/383b5b78-9b0e-4cfa-ac0a-a1c4228defbf)

Internal Server Error indikoi että SQL sovellus on haavoittuvainen SQL hyökkäykselle. Selaimen kehittäjä työkalusta saan tarkemman kuvauksen virheilmoituksesta.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/8ac83cfe-a43a-4447-a1a6-519236403ea3)

Tehtävän tavoitteena on näyttää käyttäjälle kaikki tuotteet, myös ne jotka ei ole julkaistu.
Tämä on mahdollista manipuloimalla SQL lausekette niin että lause antaa kaikki tuotteet "products" taulusta.
SQL lauseke näyttäisi tältä:

        SELECT * FROM products WHERE category = '' OR 1=1

Tämä lauseke palauttausi products taulusta kaikki kategoriat joilla ei ole mitään arvoa category attribuuttina.
Lause OR 1=1 on ehdollislause joka palauttaa aina TRUE eli SQL lause palauttaa kaikki rivit taulusta.
URL näyttäisi seuraavalta:

        https://0abf00f903691bce80a7b2f000c8003f.web-security-academy.net/filter?category=%27%20OR%201=1--

Kaksi viimeistä merkkiä kommentoi SQL lausekkeen lopun pois. SQL lause näyttää tältä tietokannassa.

        SELECT * FROM products WHERE category = '' OR 1=1 --AND released = 1.


Kaksi viivaa poistaa ehdon released = 1.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/531e59dc-560b-4711-97ce-cf46006cae63)

Videot tehtävässä helpottivat tehtävää huomattavasti.




### E) Asenna Linux virtuaalikone (Kali)
Ennen kurssin alkua olin jo asentanut Linux Kali jakelun Oracle VirtualBox sovelluksen avulla. 
Asentamiseen hyödynsin Tero Karvisen ohjeita (https://terokarvinen.com/2021/install-debian-on-virtualbox/).
Ohjeet oli suunnattu Debian jakelulle. Huomasin nopeasti että VirtualBox on päivittynyt Tero Karvisen ohjeen jälkeen. Suuria muutoksia ei kuitenkaan ollut tullut. Käyttöliittymä oli hieman muuttunut.

Asennukseen tarvitsin uusimman .iso tiedoston joka on saatavilla Linux Kali virallisilta sivuilta.
(https://www.kali.org/get-kali/#kali-installer-images). Asennuksessa käytin 64bit tiedostoa. Tiedoston koko oli 3.8 Gb. Lataamisessa meni noin 20 minuuttia. 

Annoin virtuaalikoneelle 4Gb RAM muistia käyttöön ja loin myös virtuaalikoneelle 60gb virtuaalikovalevyn.
Näytönohjaimelle annoin 128Mb koska aikaisemmasta kokemusta olen todennut että virtuaalikoneen resoluutio voi olla hieman haastava saada sopivaksi. 

Ohjeita seuraamalla onnistuin asentamaan virtuaalikoneen ja siihen VboxAdditions lisäosan. VboxAdditions lisäosa mahdollistaa jaetun leikepöydän sekä muita hyödyllisiä työkaluja jotka helpottavat virtuaalikoneen käyttöä.

Asennuksen jälkeen annoin seuraavat komennot bashissa:

        sudo apt-get update, sudo apt-get -y dist-upgrade, sudo apt-get -y install ufw, sudo ufw enable
Kyseinen komento päivittää linux jakelun uusimmat päivitykset, asentaa UFW (Uncomplicated Fire Wall) ja ottaa palomuurin käyttöön. 

Asennus sujui ongelmitta. Asennuksen aikana en dokumentoinut mitä tein. Kuitenkin asennus oli suoraviivainen ja yksinkertainen.

### F) Porttiskannaa omalta koneelta (localhost) 1000 tavallisinta TCP porttia

Seuraavan tehtävän suorittamiseen käytän NMAP työkalua joka on asenettu Kali virtuaalikoneelle.
NMAP on ohjelma joka skannaa kohde IP-avaruuden avoimet portit ja työkalulle voi antaa eri parametrejä miten laaja skannaus on.

Aloitan kokeilemalla yksinkertaisesti:

        nmap localhost
![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/e31422f2-1ec7-4ddd-ac0b-80923e16dcf6)

Mitä "nmap localhost" komento tekee niin se näköjään skannaa kohdeosoitteen 1000 porttia. 
Löysin osoitteesta (https://www.stationx.net/nmap-cheat-sheet/) "lunttilapun" nmap komennoista ja sen lipuista.

En kuitenkaan löytänyt suoraa selitystä mitä pelkkä "nmap" skannaa. Nmap omilta sivustoilta(https://nmap.org/book/man-port-specification.html#:~:text=By%20default%2C%20Nmap%20scans%20the,1%2C000%20ports%20for%20each%20protocol.) Saan kuitenkin vastauksen että pelkkä nmap skannaa 1000 tavallisinta porttia. 

Lisäämällä lipun -p voi tarkentaa mitä portteja nmap skannaa. Alla esimerkki:

 ![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/6b5b5034-bf8c-4501-9bb5-0734fcf99aad)

Komenolla:

        nmap localhost -p 1-2500

Nmap skanna kaikki portit väliltä 1-2500. Tuloksista näen että virtuaalikoneellani ei ole mitään portteja auki.
Mikä on hyvä asia koska en ole avannut mitään portteja. 

Tuloksissa selviää että 127.0.0.1 on olemassa ja hereillä. SKannaus kesti 0.0020s. Skannaus ei koskettanut muita osoitteita IP avaruudessa 127.0.0.0. Kaikki 1000 skannattua porttia ei ole avoimina.
### g) Kaikkien porttien skannaus

Kun haluan skannatta kaikki 65533 porttia jotka on paikallisella koneella käytän lippua -p-

        nmap localhost -p-

Lippu -p- tekee laajemman skannauksen kuin ilman sitä. Alla olevassa esimerkissä asensin jo pari demonia. Takempi selitys näistä on osassa i)

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/f9f28658-069c-4f54-ac14-8e6ba4773278)


### h) nmap -A

Lippu "-A" tarkoittaa seuraava https://www.stationx.net/nmap-cheat-sheet/ sivuston mukaan:

        Enables OS detection, version detection, script scanning, and traceroute

Kuitenkin testeissäni tuloksissa ei ole hirveästi eroa:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/f596feae-87b6-480b-a3a4-ade3aa514ea9)

Tuloksissa kuitenkin lukee että "Service detection performed" mutta en näe mitään tuloksia siitä.

### I) Demonien asennus ja skannaus

Seuraavaksi haluan avata muutaman portin virtuaalikoneeltani saadakseni jotain tuloksia NMAP skannauksesta.
Asennan APACHE:n sekä SSH ja otan ne käyttöön.

        sudo apt-get install apache2 ssh
        sudo systemctl start apache2 ssh

Oletuksena HTTP liikenne tapahtuu portissa 80 ja SSH portissa 22. Asennuksen sekä käynnistyksen jälkeen teen uudestaan nmap skannauksen localhost osoitteeseen.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d21d9950-0ca3-4364-9dfe-c7801b3deb25)

Tällä kertaa tulokset ovat hieman erilaiset. Nyt näen tuloksista että localhost osoitteessa on 2 porttia auki.
Tuloksissa näen myös että portit ovat "OPEN" tilassa ja mitä protokollaa ne käyttävät.
Minun tuloksissani näen että SSH palvelu on avoinna portissa 22 ja käyttää TCP protokollaa. Näen myös ettö portti 80 on avoinna ja käyttää TCP protokollaa HTTP palveluun.

Laajassa porttiskannauksessa saan huomattavasti enemmän tietoa.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/8ba7af09-bf0a-4e67-9014-945d3b698c3a)

Laaja porttiskannauksen kertoo minulle portiss 22 toimivan palvelun versiotiedot (OpenSSH 9.6p1 Debian 4(protocol 2.0)) sekä SSH 256 bittisen julkisen avaimen.
Saan samat tiedot portissa 80 toimivasta webpalvelimesta (Apache httpd 2.4.58 ((Debian)) sekä http sivuston otsikon "Apache2 Debian Default Page: It works" mikä on apache vakio aloitussivu.
APachesta saan myös tiedon palvelimen otsikosta (http-server-header)

TCP/IP fingerprint osio ei aukea itselleni. Wikipediassa on artikkeli aiheesta (https://en.wikipedia.org/wiki/TCP/IP_stack_fingerprinting) jossa kerrotaan että sormenjälhet ovat tietoja TCP/IP stackista jota NMAP voi hyödyntää selvittääkseen skannatun IP osoitteen käyttöjärjestelmä.

Viimeisenä osiona tuloksissa lukeekin "Service Info: OS:Linux" mikä osoittaa että skannattu kohde toimii linux käyttöjärjestelmällä.

### J) OSINT työkalu "Builtwith.com"

Builtwith.com on sivusto mikä auttaa selvittämään miten webbisivut on rakennettu ja mitä eri palveluita sen rakentamiseen on käytetty. Nettisivu on maksumuurin takana mutta perustoimintoja voi suorittaa ilman mitään rekisteröytymistä.

Käytän omaa nettisivuani esimerkkinä. Nettisivuni on rakennettu Debian virtuaalikoneelle joka on vuokrattu linode.com sivuston kautta. Sivustoni on staattinen nettisivu mikä näyttää ionosondien tuloksia eri avaruuspalveluilta.

Builtwith.com näyttää että sivuni käyttää googlen fontteja mikä on saatu ilmaisen API kautta.
Olen käyttänyt sisällön luomiseen Nicepage palvelua joka luo HTML koodin. En osannut koodata HTML niin käytin graaffista liittymää joka luo HTML tiedoston. En suosittele. Tiedosto on aivan hirveä ja mahdoton muokata.
Builtwith.com näyttää että Webpalvelimeni toimii Apache Web serverillä.

Builtwith näyttää myös mistä olen vuokrannut DNS nimen sivustolleni, Namecheap DNS. Namecheap tarjoaa myös sähköpostipalveluita joita en käytä nettisivuillani. Builtwith näyttää kuitenkin että sivustolla on sähköpostipalvelu käytössä.

Linkki tuloksien lukemiseen: https://builtwith.com/fredrikakerlund.com

Uskon että builtwith on oiva työkalu jolla saa selville miten eri nettisivut on rakennettu ja mitä teknologioita on käytetty sen luomiseen. 
Kuitenkin maksumuuri sivustolla on iso miinus. 




        












    



