

# Johdanto

Viikon tehtävänä on tutustua Fuzzaamiseen sekä salasanojen murtamista. Molemmat näistä asioista on minulle täysin tuntemattomia ja valitettavasti en päässyt osallistumaan luenolle. Joudun itseopiskelemaan kaikki viikon aiheet yksin.
## <u> x) Lue ja tiivistä </u>

### Find Hidden Web Directories - Fuzz URLs with ffuf

  - Fuff on ohjelma joka mahdollistaa piilotettujen tiedostojen löytämisen Websivuilta.
  - Tätä voidaan kutsua Fuzzamiseksi
  - Fuff on erittäin nopea ohjelma joka tuottaa tuhansia GET pyyntöjä kokeillakseen vastaako nettisivu pyyntöihin.
  - Fuff avulla voidaan automatisoida muutoin erittäin manuaalisen työn.
Lähde: https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/

### Cracking Passwords with Hashcat

  - Hashcat on työkalu jolla voidaan murtaa salasana tiivisteitä.
  - Salasana tiiviste on salasana joka on muunnettu tietyn algoritmin kanssa. Tiivistäminen on yksisuuntainen toiminto.
  - TIivisteitä voi kuitenkin kokeilla. Tähän tarkoitukseen Hashcat on luotu.
  - Hashcat tarvitsee sanalistan toimiakseen. Rockyou.txt on hyvin suosittu tiiviste sanakirja jossa on yli 14 miljoonaa tyypillistä tiivistettä.

Lähde: https://terokarvinen.com/2022/cracking-passwords-with-hashcat/
### Crack File Password With John

  - John the ripper on ohjelma joll voidaan murtaa eri formaatin salasanoja.
  - Johnin avulla voidaan esimerkiksi käyttää sanakirjoja murtaaksen salattuja tiedostoja.
  - John the ripper on hyvin samankaltainen ohjelma kuin Hashcat. Erona kuitenkin on että Hashcat vaikuttaa huomattavasti käyttäjä ystävällisemmältä käyttää.

Lähde: https://terokarvinen.com/2023/crack-file-password-with-john/

## <u> a) Asenna Hashcat ja testaa sitä </u>

Minulla on uusin Kali distro asennettuna ja siinä on asennettu uusin versio Hashcat ohjelmasta. Käytössäni on versio 6.2.6.

Minulla on myös asennetuna Hashid versio 3.1.4 sekä WGET. Näillä työkaluilla pystyn murtamaan Tero Karvisen esimerkki salasanan.

Esimerkkisalasana tiiviisteenä käytän Tero Karvisen ohjeessa olevaa tiivistettä 

    6b1628b016dff46e6fa35684be6acc96

Salasanan murtamiseen tarvitsen myös sanalistan. Onneksi Kali distrossa on jo valmiiksi ladattu useampi salasanalista. Listat löytyvät hakemistosta "/usr/share/wordlists"

Tässä tehtävässä käytän listaa "rockyou" mikä on hyvin suosittu ja sisältää yli 14 miljoonaa tunnettua salasanaa.

Selvittääkseni tiivisteen formaatin käytän seuraavaa komentoa:

    hashid -m 6b1628b016dff46e6fa35684be6acc96

Vastauksena saan seuraavanlaisen tuloksen. Kannattaa siis käyttää hyviä salanoja.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/5bdf053c-6596-4392-9590-cbe2a2a2116e)

Ensimmäisena formaattina kokeilen MD5 algoritmilla tehtyä tiivistettä. Hashcatissä tämä on tila `0`

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/8722a992-1ef6-4e98-87c8-bcfbe65f9a2c)

Ohjelman ajettua läpi rockyou.txt tiedoston saan seuraavan ilmoituksen.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/3efa7b85-e50c-453f-a1fd-57d644d1b3d3)

Salasanan murtamiseen meni siis 0 sekunttia. 

Mitä komentoni teki:

  - sudo : ohjelma vaatii sudo käyttäjän oikeudet
  - hashcat : Ajaa ohjelman
  - -m 0 : tiivisteen tyyppi, käytin tässä esimerkissä MD5 algoritmia
  - '6b1628b016dff46e6fa35684be6acc96' : tiiviste jonka mursin
  - /usr/share/wordlists/rockyou.txt : sanalista jota käytin murtamiseen.
  - -o solved : Lippu joka tallentaa tuloksen työstökansioon nimeltä solved.
![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/aaf6471b-4e2b-46af-938c-abf23d22d41f)

Salasana on siis `summer`.

Hashcat vaikuttaa hyvin yksinkertaiselta käyttää.

Jotta tehtävässä olisi hieman haastetta haluan murtaa toisen tiivisteen jonka selkokielistä salasanaa en tiedä.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/c3d96760-73b3-4bb4-87ec-2ac7271df861)

Kyseessä on salasana `password` joka on salattu DES salauksella. Hashcat käyttää silloin moodia 1500

Ja tiedosto joka hashcat tuottaa näyttää seuraavanlaiselta:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d05b9b46-f3c2-41f3-8a0a-fdeca64a401a)

Haluan vielä testata murtaa suomenkielistä salasanaa käyttäen `rockyou` sanalistaa. Salasanan jonka haluan murtaa on selkokielisenä:

    SalainenSalasana
Jotta saan selkokielisestä salasanasta tiivisteen käytän seuraavaa komentoa:

    echo -n "SalainenSalasana" | md5sum

Lähde: Chatgpt, kysymällä seuraavan kysymyksen saan komennon `how do i hash a string in kali linux`.

En tarvitse käyttää `hashid` ohjelmaa koska tiedän että tiiviste on tehty MD5 algoritmillä.

Komentoni näyttää seuraavanlaiselta:

    hashcat -m 0 '6d9f3a7ed4d276cfd46f721079971171' /usr/share/wordlists/rockyou.txt

Yllätyin koska Hascat ei löytänyt vastaavaa tiivistettä sanakirjasta. Hashcat palasi statuksella `exhausted` joka tarkoittaa että salasanalista käytiin läpi mutta vastaavuutta ei löytynyt.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/a388f7b0-791c-4d4f-a8a6-217eb02399ea)

Kokeilen vielä käyttää kaikkia sanalistoja jotka on Kalille valmiiksi asennettu. Yllätyin koska mitään osumaa ei löytynyt. Hashcat voi käyttää hakemistoa josta se etsii useita sanalistoja. Komento näyttää silloin tältä:

    hashcat -m 0 '6d9f3a7ed4d276cfd46f721079971171' /usr/share/wordlists/

Lähde: https://terokarvinen.com/2022/cracking-passwords-with-hashcat/

## <u> b) Salainen, mutta ei multa. Käytä Fuff Tero karvisen esimerkki tehtävään </u>

Tehtävänä on käyttää FuFF työkalua jolla Fuzzaaminen tapahtuu salamannopeasti. Fuff virallinen julkaisu löytyy GIthubista osoitteessa: github.com/ffuf/ffuf/releases/download/v2.0.0/ffuf_2.0.0_linux_amd64.tar.gz

Lataamiseen käytän WGET työkalua. Ohjelma on paketoitu .tar tiedostoksi ja avaan sen komennolla `tar -xf ffuf_2.0.0_linux_amd64.tar.gz`. TÄmän jälkeen minulla on fuff asennettu binääri tiedostona kotihakemistooni. Aika alkaa leikkiä Tero Karvisen esimerkki kohteella.

Ensimmäiseksi lataan esimerkkikohteen Tero Karvisen sivustolta ja muutan käyttöoikeudet tiedostolle:

    wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-1
    chmod u+x dirfuzt-1

Tämän jälkeen käynnistän esimerkkikohteeni ja kokeilen että se toimii:

    ./dirfuzt-1

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/2c2f2440-a1ec-485a-9f79-30f66747433d)

Ohjelma toimii paikallisesti osoitteessa 127.0.0.2:8000.

Ennen kuin lähden fuzzaamaan kohdetta irroitan kali koneeni verkosta.

Komentoni fuzzausta varten:

    ./ffuf -w /usr/share/wordlists/wfuzz/general/common.txt -u http:127.0.0.2:8000/FUZZ

Komento selitettynä:
  - ./fuff : Ajaa FFuf ohjelman
  - -w : Mitä sanalistaa ohjelma käyttää
  - /usr/share/wordlists/wfuzz/general/common.txt : Sanalistani sijainti
  - -u : Määrittää kohteen
  - http:127.0.0.2:8000/FUZZ : Fuzz sana on placeholder. Ohjelma kokeilee siihen kohtaan sanalistassa olevat vaihtoehdot.

Vastaukseni saan kuitenkin että mikään hakemisto ei löydy esimerkkikohteesta.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/944a3e12-e1cb-45f2-9410-773f4eeb67b9)

Pingaan palvelua ja se kuitenkin vastaa joten onko vika sitten sanalistassa? Piruuttani kokeilen toista sanalistaa joka on valmiiksi asennettu kaliin. Käytän listaa `admin-panels.txt`.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d06fb5d7-069a-4dd8-9d32-1acce3bd710a)

Vastaus on kuitenkin sama.

Sammutan `dirfuzt-1` ja kokeilen käyttää kohdetta `dir-fuzt0`jota Tero käytti esimerkissä.

    $ wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-0
    $ chmod u+x dirfuzt-0
    $ ./dirfuzt-0
    Learn more at TeroKarvinen.com
    http://127.0.0.2:8000

Mutta tuloksena saan saman ongelman:


Kokeilen vielä lataa toisen version common.txt sanalistan SECLIST sivustolta

    wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt

Mutta jälleen kerran sama ongelma. En tiedä yhtään missä vika saattaa olla.

Ja tajusin ongelma. Pieni kirjoitusvirhe!!!! Alkuperäinen komentoni kohdisti hyökkäyksen osoitteeseen :`http:127.0.0.2:8000`. Eli unohdin muutaman kenoviivan. Iso facepalm.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/a89dc1bc-b801-4914-9ebf-b4cc582a88c7)

Siirryn takaisin hyökkäämään dirfuzt-1 kohteeseen.

Komentoni:

    ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ
    
Vastauksena saan tuhansia GET vastauksia koodilla 200. Webbipalvelu antaa 200 ilmoituksen vaikka hakemistoja ei ole olemassa.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/1c515c71-3fe6-4220-8376-60b8514cca51)

Kuvankaappauksessa on vain muutama osuma. Niitä on tuhansia lisää. Yhteistä tuloksilla on että suurin osa vastauksista on 154 merkkiä pitkä. FIltteröidäkseni tulokset poistamaan kaikki vastaukset jotka on 154 merkkiä pitkät käytän lippua `-fs 154`. Tällä kertaa sain vain vastaukset 7 eri GET pyyntöön:


![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/b466f3a4-4c8d-4f46-821d-cc90dab374ab)

Kokeilen curlaa ilmeisintä näistä, wp-admin (Wordpress admin sivu):

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/52032cc3-7c60-4d12-9ddd-69d61dcf7d6a)

Ja sieltähän se lippu löytyi!

Kokeilen myös noita .git päättyisiä hakemistoja:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/9c7639d1-a0f1-413d-8d75-27389705cd05)

Ja kaikki .git alkuiset hakemistot antavat saman vastauksen.

Kuitenkin vastaus render/https://www.google.com ei näytä olevan hakemisto. En tiedä mikä tämä 200 vastaus get pyyntöön on.

<b>Yhteenveto</b>

Fuzzaaminen vaikuttaa melko tehokkaalta aktiivisen tiedustelun työkaluna. Pitää muistaa olla tarkkana kun kirjoittaa osoitteet. Muutoin voi kestää hyvin pitkään ratkaista ongelmia.

Lähde: https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/


## <u> c) Asenna John The Ripper ja kokeile sen toiminta </u>

Asentaakseni John The RIpper ohjelman tarvitsen seuraavat ohjelmat:

  - micro	: Text editor
  - bash-completion	: Use tab to complete file names
  - git	Clone (copy) : Jumbo John source code
  - build-essential :	C compiler and related tools
  - libssl-dev :	John requirements
  - lib1g zlib1g-dev zlib1g-gst : 	For John ZIP support
  - libbz2-1.0 libbz2-dev	 :For John 7zip support
  - atool : zip	Compression tools, 'aunpack foo.zip', 'unzip foo.zip'
  - wget	: Web downloader for command line

Ohjelmien asentamiseen jälkeen on aika "compile" JohntheRipper ohjelman.

Aloitan kloonamalla OpenWall käyttäjän GIThub repositoryn missä JohnTheRipper ohjelma on.

    git clone --depth=1 https://github.com/openwall/john.git

Seuraavaksi annan komennot: 

    cd john/src/	
    ./configure
Tämä asettaa oikeat konfiguraatiot kuntoon.

Tämän jälkeen voidaan kääntä ohjelma. (Compile)

    make .s clean && make -sj4

Ohjelma teki paljon asioita. Seuraavaksi kokeilen toimiiko ohjelma

    ./john

Ja toimii se ja minulla on käytössä versio 1.9.0

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/41809ef2-4d78-4da3-ab27-edc8d8b76d87)


Melkoinen säätö asentaa ohjelma. Seuraavaksi kokeillaan JohnTheRipperin toiminta. TÄtä varten lataan esimerkki ZIP kansion joka on salasana suojattu. Tero Karvinen on luonnut valiin tiedoston.

    wget https://TeroKarvinen.com/2023/crack-file-password-with-john/tero.zip

Kokeilen avata ZIP tiedoston mutta se ei ole mahdollista ilman salasanaa.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/5a19eeb3-c3d7-433f-81db-b758117d042e)

Sitten lähdetään murtamaan salasanaa JohnTheRipperin avulla.

Ensimmäiseksi pitää saada salasana tiiviste tiedostosta. Ja se tapahtuu seuraavalla komennolla:

    /home/kynaniska/johntheripper/john/run/zip2john tero.zip>tero.zip.hash

Tämä komento luo uuden tiedoston kansioon missä `tero.zip` sijaitsee.

Tämän jälkeen pystyn murtamaan salasanan:

    ./john tero.zip.hash
    
![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/f7a4d49c-f448-40d0-93d1-ed58c0b0e1a9)


Salasana on siis `butterfly`.

Ja avaan ZIP tiedoston salasanalla.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/775ae5e4-3464-4904-ab84-f291a206fd34)


Lähde: https://terokarvinen.com/2023/crack-file-password-with-john/

## <u> d) Fuffme. Asenna Ffufme harjoitusmaali paikallisesti omalle koneellesi. Ratkaise tehtävät</u>

Tässä tehtävässä on tarkoitus asentaa harjoitusmaali jota kohtaan harjoitellaan FUZZaamista.

Tätä varten tarvitsen DOCKER ohjelman koska harjoitusmaali toimii paikallisesti DOCKER containerissa.

Docker säiliö löytyy githubista : https://github.com/adamtlangley/ffufme

Minulle Docker säilöt on täysin tuntemattomia joten seuraan Tero Karvisen ohjeita tarkkaan.

    $ git clone https://github.com/adamtlangley/ffufme
    $ cd ffufme/
    $ sudo docker build -t ffufme .

Ymmärrän että komennot rakentavat docker säilön. Rakentamisen jälkeen voidaan käynnistää säilö paikallisesti.
Rakentamiseen meni noin 2 min.

TÄmän jälkeen käynnistän docker säilön:

    sudo docker run -d -p 80:80 ffufme

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/c7045433-8c5e-4f06-b3ee-4c6a26ed3ba7)

Siellähän ikioma ensimmäinen docker säilö pyörii. Onpa kätevää.

FFUFme palvelin näyttää olevan samanlainen kuin webgoat. Sivustolla on ohjeita miten ratkaistaan tehtävät.

Aloitan lataamalla tarvittavat sanalistat:

    $ wget http://ffuf.me/wordlist/common.txt
    $ wget http://ffuf.me/wordlist/parameters.txt 
    $ wget http://ffuf.me/wordlist/subdomains.txt

Sen jälkeen alan Fuzzaamaan docker säiliötäni. Irroitan virtuaalikoneeni taas internetistä.

  	  ffuf -w $HOME/wordlists/common.txt -u http://ffuf.me/cd/basic/FUZZ

 Ja vastauksena löysin 2 tiedostoa: Class ja development.log.

 ![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/7a8baedb-2672-4257-8e1a-062b08232692)

 Seuraavassa tehtävässä käytetään recursiivista metodia.

 Käytän lippua -recursion joka aloittaa uuden fuzzaamisen jos se löytää kansion joka vastaa GET pyyntöön. Skannaus löysi /admin/users/96 tiedoston.

Seuraavaksi kokeillaan lippuja -e .log joka lisää sanakirjaan jokaisen sanaan loppuun .log. Tällä metodilla pystyn etsimään lokitiedostoja.

Komentoni: 

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/ce1d78fd-9847-4f4b-9e91-c5da75282789)'

Lopputulos: 

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d5ef8928-82cc-4942-891b-721eac5ab325)

user.log tiedosto löytyy siis palvelimelta.

Seuraavassa tehtävässä on tarkoitus filteroida vääriä positiivisia tuloksia jotka tulee fuzzaamalla helposti. Tämä on sama mitä tein tehtävässä b).

Komenolla: 

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/769f8006-5086-425e-8b60-f01fd83c0382)

huomaan että kaikki vastaukset on 669 merkin pituisia. Joten filtteröin ne pois.

Komento:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d15d92ca-f96c-4d73-9705-e04180872f8e)

Tulos:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/4cd27848-b5c7-41d9-9ebc-8fc8e1a590a7)

Löysin tiedoston nimeltä `secret`.

Seuraavassa tehtävässä jos yritän päästä sivulle localhost/cd/param/data saan vastauksen "required param missing".

Käytän seuraavaa komentoa joka korjaa tilanteen. Komento fuzzaa oikean parametrin sanakirjasta.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/038bff77-9094-4870-b0a4-4f7b47640731)

Tuloksena saan tiedoston debug esille.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/11c86619-aa9f-4554-99d1-7bc77328e35e)

Seuraavassa tehtävässä kohde on rajoittanut GET pyyntöjen määrän.

Kokeilen ensin fuzzaa normaalisti:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/99082c7d-e388-41c1-8276-3136b5a13ef4)

status `429`tarkoittaa että palvelin estää GET pyyntöjen lähettämisen. Tämän takia saan kaikki sanalistassa olevat sanat vastauksena. Ratkaiseksi tämän korjaan pyyntöjen nopeuden 0.1sec/pyyntö. Komentoni näyttää tältä:

KUVA TÄHÄN

Nopeasti huomaan että skannaus on huomattavasti hitaampi. SKannauksessa menee noin 2 minuuttia.

Vastauksena saan `oracle` tiedoston löydettyä.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/7551c59c-9edf-41a4-95cb-72761865d6d5)

FFUFME viimeisenä tehtävänä on skannata subdomaineja. 

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/9ba3df26-a94a-4951-899c-6347d6aa2fef)

Komento skannaa muita hosteja samassa verkossa. Vastauksena saan paljon vääriä positiivisia vastauksia. Joten filtteröin taas kaikki tiedostot jotka ovat kooltaan 1495 merkkiä.

Tällä tavoin saan esille subdomainin `redhat.ffuf.me`.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/f3f1cec3-9e11-459d-9ec0-743e37522ff0)

<b> Yhteenveto </b>

ffufme vaikuttaa hyvin helppokäyttöiseltä harjoitusmaalilta. Melko hauska tehdä näitä harjoitteita.


## <u> e) Tee msfvenom-työkalulla haittaohjelma, joka soittaa kotiin (reverse shell). Ota yhteys vastaan metasploitin multi/handler -työkalulla. </u>

## <u> f) Asenna Windows virtuaalikoneeseen. Voi olla esimerkiksi Metasploitable 3 tai Microsoftin sivuilta saatava ilmainen kokeiluversio. </u>

## <u> g) Ota Windowsiin graafinen etähallintayhteys Linuxista. Käytä RDP:tä eli Remote Desktop Protocol.</u>

