# Johdanto

Viikon tehtävänä on tutustua porttiskannaukseen hieman tarkemmin. Viikon tehtävässä skannataan myös haavoituvusta Metasploit 2 virtuaalikonetta joka asennetaan isäntäkoneelle.

Isäntäkoneena toimii alla oleva rauta:
Alusta: Lenovo ideapad 5 pro, R7 5000 sarja 16gt ram, 500gt SSD
OS: Windows 11

## <u>Lue ja tiivistä</u>

### Lyon 2009: Nmap Network Scanning: Chapter 15. Nmap Reference Guide:
  #### Port Scanning Basics 


Tietoturvaohjelma Nmap tunnistaa portit kuuteen tilaan: avoin, suljettu, suodatettu, suodattamaton, avoin/suodatettu ja suljettu/Suodatettu. Nämä tilat kertovat, onko portti aktiivinen ja kuinka Nmap näkee sen verkkoyhteyksien kautta. Tämä auttaa havaitsemaan mahdollisia tietoturvauhkia ja suojaamaan verkkoresursseja.
  
 ####  Port Scanning Techniques 


Nmap tarjoaa erilaisia skannausmenetelmiä porttien tarkasteluun:

sS (TCP SYN scan):

Nopea ja suosittu skannausmenetelmä.
Lähettää SYN-paketin ja odottaa vastausta.
Avoin portti vastaa SYN/ACK-paketilla, suljettu portti RST-paketilla, ja suodatettu portti ei vastaa.

sT (TCP connect scan):

Käyttää käyttöjärjestelmän connect-järjestelmäkutsua.
Vähemmän tehokas kuin SYN-skannaus, koska se avaa täyden yhteyden.
Kohdekoneet saattavat kirjata yhteyden.

sU (UDP scan):

Lähettää UDP-paketin jokaiselle tavoiteportille.
Suljetut portit vastaavat ICMP-porttia tavoittamattomia -viesteillä, suodatetut portit muilla ICMP-viesteillä.
Avoimet portit vastaavat UDP-paketilla.

Lähteet: https://nmap.org/book/man-port-scanning-techniques.html
https://nmap.org/book/man-port-scanning-basics.html


### KKO 2003:36. Alaikäinen tuomittiin Osuuspankkikeskuksen porttiskannaamisesta, korkeimman oikeuden ratkaisu.


Tuomittu alaikäinen yritti murtautua osuuskunnan tietojärjestelmään skannaamalla sen verkon portteja. Hovioikeus katsoi hänet syylliseksi tietomurron yritykseen. Hänelle määrättiin sakkoja ja velvoitettiin korvaamaan osuuskunnalle ja yhtiölle aiheutuneet vahingot. Korkein oikeus vahvisti tuomion, eikä sovitellut korvauksia A:n nuoren iän ja varallisuuden perusteella. A:n tietoturvatietämyksen ja teon tahallisuuden vuoksi hänen täytyy korvata aiheutetut vahingot kokonaisuudessaan.

Se mikä iski silmääni oli seuraava lause: 

A:n kone oli sisältänyt lisäksi huomattavia määriä listoja, joissa oli ollut porttiskannauksella kerättyä tietoa tai porttiskannaukseen käytettävää tietoa

Tuomittu siis selvästi oli tehnyt tätä aikasemmin eikä ollut pelkästään "scriptkiddie" joka pelleili ja kokeili asioita.

Lähde tekstille: 
https://finlex.fi/fi/oikeus/kko/kko/2003/20030036

## <u> a) Asenna Kali virtuaalikoneeseen </u>

Edellisen viikon tehtävissä asensin jo Kali Virtualikoneeseen. Raportointi löytyy: https://github.com/FredrikAkerlund/Starting-pentesting/blob/main/h1%20Hacker%20Warmup.md

## <u> b) Metasplotable 2 asennus virtuaalikoneeseen.</u>

Metasploitable 2 on tietokonealusta, joka on tarkoituksellisesti luotu heikkouksien ja haavoittuvuuksien täyttämiseksi.
Se on tarkoitettu tietoturvaan ja penetratiotestaamiseen eli tietojärjestelmien testaamiseen mahdollisten hyökkäysten ja haavoittuvuuksien varalta.
Metasploitable 2 on suunniteltu auttamaan tietoturva-asiantuntijoita, tutkijoita ja opiskelijoita harjoittelemaan ja oppimaan tietoturvaongelmista ja niiden ratkaisemisesta.
Metasploitable 2 virtuaalikoneen voi ladata osoitteesta: https://docs.rapid7.com/metasploit/metasploitable-2/
En halunnut kirjautua Rapid7 palveluihin joten hyödynsin Sourceforge.net latauspalvelua.
ZIP tiedoston koko on 800Mt.

## <u>c) Metasploitablen eristäminen ulkoverkosta.</u>

Metasploitable 2 virtuaalikonetta ei kannata altistaa ulkoverkolle joten luon uuden "host only" Verkkoadapterin Virtualboxin sisällä. Lisään samaan verkkoon aiemmin asennetun Kali virtualikoneeni.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/65f70a12-c3bd-4c58-8160-03bfc08445ca)

Ennen kuin asennan Metasploitablen haluan todentaa että Kali koneeni on irti verkosta

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/dd6ece7d-abc1-4bef-a12e-3939d2cc5a09)

Sourceforgen kautta ladatun tiedoston sisällä on virtuaalikovalevy johon on asennettu Metasploitable 2 OS.

Asennan uuden debian koneen ilman ISO kuvaa. Virtuaaliseksi kovalevyksi valitsen lataamani metasploitable.vmdk tiedoston. Tämä tiedosto sisältää koneen.
Annan koneelle 4gb RAM muistia. 
![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/3d5227f5-c588-462e-b557-c206847a9c37)

Ennen kuin käynnistän koneen liitän sen virtuaalikytkimeen.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/787f01bd-3e74-4560-8e3f-d5cdaf69d9eb)

Nyt uskallan käynnistää virtuaalikoneen.

Koneen vakio käyttäjä ja salasana on:

		msfadmin

Käynnistin koneen ja kokeilin ping 1.1.1.1 ja sain vastauksia ICMP pyyntöihin.
Tarkastan VBOX asetuksista että teinhän verkkoasetukset oikein.
Olin unohtanut kytkeä NAT:tauksen pois. Minulla oli käytössä 2 verkkokorttia jonka takia kone sai yhteyttä verkkoon.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/c763ae20-c392-40da-8570-2aca8dff0e60)

Hu toivottavasti isäntä koneeni ei ole saastunut.

Kokeilen uudestaan käynnistää metasploitable koneen mutta nyt on oikeat verkkoasetukset. Tällä kertaa kone ei ole kytketty ulkoverkkoon.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/b00eee61-4f1d-4c38-a2e6-37ab067fbe8e)

Kali koneella yritän pingata osoitetta 192.168.12.7 (Metasploitable kone)

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/d1e8121b-b26c-47ee-afc5-2d4963e299a0)

Mahtavaa kone vastaa!! Ei muuta kuin skannailemaan.

## <u> d) Metasploitablen etsiminen NMAP avulla</u>

Haluan löytää metasploitable koneeni Kali virtuaalikoneella. Tähän käytän NMAP työkalua. Seuraan skannausta Wiresharkin avulla. Tässä vaiheessa voin vielä varmistaa että KALI koneeni on myös irti ulkoverkosta. Wireshark skannaus ei näytä mitään liikenettä kuin aloitan skannauksen.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/f32353fb-ae26-4b00-af6a-c787bde113f5)

Skannauksessa käytän lippua -sn nmap komennon ohella.
Lippujen tarkoituksen selvittämiseksi käytän ohjetta joka selittää minulle toiminnot.
https://www.stationx.net/nmap-cheat-sheet/

Komentoa jota käytän:

		nmap 192.168.12.1/24 -sn
Komento skannaa ip osoitteet 192.168.12.1-255 ja löytää pelkät ylhäällä olevat HOSTit.

Tulos:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/9178703f-a45c-4a62-a9b4-238b756c5005)

Skannaus löysi 2 hostia. Toinen on KALI koneeni ja toinen on Metasploitable. 

Pakettisnifferi näkyy ARP kyselyt jotka nmap ohjelma tekee.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/ffd75834-1303-4f6d-8412-2e160258cd25)

Nmap tekee ARP broadcast kyselyn kaikista ip osoitteista 192.168.12.1-255.

Tarkastan vielä että onko 192.168.12.7 metasploitable. Tiedän että metasploitablella on käynnissä WEB palvelu.

		curl 192.168.12.7
![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/ebddc06b-40ec-4670-8dbe-3b236f7115e9)

Löyty!! Seuraavassa vaiheessa tutkin tarkemmin metasploitablen portteja.

## <u>e) Metasplotablen tutkiminen NMAP avulla</u>

Jotta saan tarkemman kuvauksen metasploitable tietokoneesta teen uuden NMAP skannauksen.

Teen laajan skannauksen

		nmap 192.168.12.7 -A -p0-
"-A" = Käyttöjärjestelmän selvittäminen
"-p0-" =  skannaa portit 1- 65535

Skannauksen aikana Wiresharkissa vilisee paljon erilaisia paketteja. (TCP,UDP,HTTPS,HTTP,FTP jne.)

Skannaus kesti 211 sekunttia.

Avonnaisia portteja ja mitä palveluita jotka tunnistan:

21		ftp
	Tässä huomiona että anonynous logon FTP login allowed.
 
22		opn SSH

23 		telnet
	Telnet on lähtökohtaisesti turvaton yhteys. Telnet lähettää kaikki tiedot Plain tekstinä
 
25 		smtp
	Sähköpostipalvelu


80 		http
	Apache Webbi palvelu

Asiat jotka herätti huomiota:
6697 IRC palvelin. Nmap skannaus antoi tuloksena Admin sähköpostin. admin@Metasploitable.LAN.

Skannaus tuotti erittäin paljon tulosta. Jokaista porttia voisi tutkia tarkemmin ja varmasti löytää vanhoja sertifikaatteja tai muita haavoituvuuksia. Skannauksessa huomasin myös että nmap tuotti melko paljon verkkoliikenettä ja -A -p0- ei välttämättä ole aina oikea ratkaisua. IDS järjestelmät varmasti huomaavat tällaisen määrän ARP kyselyitä.

## <u> f) NMAP tutkimisen tulokset </u>

Haluan tallentaa tulokset suoraan tektsti tiedostoon. 
Käytän komentoa:

		nmap 192.168.12.7 -p0- -A -on foobar
Lippu -oN tekee tiedoston nimeltä foobar missä on skannauksen tulos.

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/3b91a9dd-cc68-48f2-aa25-4f986daea577)

## <u>g) Shell istunnon tallentaminen</u>

Komento "script" on työkalu joka tallentaa koko bash istunnon tiedostoon. Se on työkalu joka käynnistyy komennolla "script" ja loppuu ctrl+c.

Komento voi olla hyödyllinen kun haluaa tallettaa kaikki toiminnot jotka on tehty.

Tallennan istuntonti tiedostoon "foobar" työpöydälleni. Ja se on massiivinen. 55Mb pelkkää tekstiä.


## <u> h) Lokien tarkastelu </u>
Tehtävän anto: Etsi kaikki maininnat jostain osoitteesta, palvelusta tai vastaavasta kaikista tallennetuista tuloksista ja lokeista.

Tätä tehtävää en ihan ymmärrä. Kuitenkin katson mitä tietoja löydän 192.168.12.7 hakusanalla:

![image](https://github.com/FredrikAkerlund/Starting-pentesting/assets/122887178/ea2705be-f73e-4490-be77-e1f876854b74)

## <u>i) Ajonaikaisista komennoista NMAP</u> 

nmap ajon aikana voi saada lisätietoja skannauksesta joka on menossa.
Lisätietoja näistä löytyy nmap viralliselta sivustolta: 
https://nmap.org/book/man-runtime-interaction.html

Mielestäni kätevin näistä on kun painaa mitä tahansa näppäintä ja nmap näyttää skannauksen vaiheen.

Muita komentoja:

- v, lisää tai vähentää tietoja joka skannaus antaa skannauksen aikana.
- d, lisää tai vähentää debuggauksen tason skannauksen aikana
- p, näyttää packettracerin skannauksen aikan, sama kuin snifferi
- ?, antaa ohjeet mitä ajonaikaisia komentoja voi käyttää.

# <u>Yhteenveto</u>

Viikon tehtävät olivat mielestäni mielenkiintoiset ja päästiin kokeilemaan skannausta oikeeseen kohteeseen. Viime viikkon verrattuna tehtävät olivat mielestäni helpommat ja sujuivat ongelmitta.

Viikon tehtävät luovat perustaa tulevalle. Skannaus vaikuttaa olevan perustyökalu pentestauksessa.

Viikon aikana jatkan overthewire ja muita tunkeutumis harjoitteita. 
